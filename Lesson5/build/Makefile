# compiler configuration
CXX := g++
CPPFLAGS := -Wall # to show all the warnings 

# the prime target
EXE := StudentMgr

# libraries
LIBPATH := -L../lib
LIBS := -lstu

# source files
SUBDIR := $(shell ls ../src -R | grep /)
SUBDIRS := $(subst :,/,$(SUBDIR)) # the directories where source files are
SOURCE := $(foreach dir,$(SUBDIRS),$(wildcard $(dir)*.cpp)) # the path to source files
vpath %.cpp $(subst : ,:,$(SUBDIR))

# headers
INCPATHS := $(subst ../,-I../,$(SUBDIRS))
INCPATHS += -I../include/

# objects
OBJS := $(foreach dir,$(patsubst %.cpp,%.o,$(SOURCE)),$(notdir $(dir))) # objects wiil be saved in "build/"

# dependencies
DPPS := $(SOURCE:.cpp=.d)

# generate the executable, linking to shared libraries
$(EXE) : $(OBJS)
	$(CXX) -o $(EXE) $(OBJS) $(LIBPATH) $(LIBS)

# generate objects
$(OBJS):%.o:%.cpp
	$(CXX) -c -o $@ $< $(CPPFLAGS) $(INCPATHS)

# include dependencies
include $(DPPS)

# automatically generate dependencies
%.d:%.cpp
	@echo "Creating $@ ..."
	@set -e; rm -f $@; \
	$(CXX) $(INCPATHS) -MM $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

# to clean all the files generated by the compiler
.PHONY : cleanall cleanobj cleandp
cleanall : cleanobj cleandp
	-rm $(EXE)
cleanobj :
	-rm $(OBJS)
cleandp :
	-rm $(DPPS)